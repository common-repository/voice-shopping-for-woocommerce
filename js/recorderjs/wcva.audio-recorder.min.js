!function(t){var n=wcvaWorkerPath;t.Recorder=function(t,e){var o=e||{},a=o.bufferLen||4096;this.context=t.context;var r=t.context.createAnalyser();t.connect(r),r.fftSize=2048;let c=null,l=null,i=null,s=null,u=!1,f=0,d=0,h=null,p="",v=17;this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(a,2,2):this.node=this.context.createJavaScriptNode(a,2,2);var w=new Worker(o.workerPath||n);w.postMessage({command:"wcvaInit",config:{sampleRate:this.context.sampleRate}});var m,g=!1;this.node.onaudioprocess=function(t){if(!g)return;"textarea"==p.toLowerCase()&&(v=40);var n=new Uint8Array(r.frequencyBinCount);r.getByteFrequencyData(n);var e=0;let o=n.length;for(let t=0;t<o;t++)e+=n[t];var a,m;m=e,l=null==(a=l)?m:(4*a+m)/5,l=parseInt(l),null==i?i=l:l<i&&(i=l),null==s?s=l:l>s&&(s=l)>2*i&&(u=!0),c+10<l&&(d=0,f+=1),c-10>l&&(f=0,d+=1),c=l,d>v&&u&&function(){try{null!=h&&-1!=(h.className||"").indexOf("listening")&&h.click()}catch(t){console.log("WCVA Error: Unable to reset Mic button.")}}(),w.postMessage({command:"wcvaRecord",buffer:[t.inputBuffer.getChannelData(0),t.inputBuffer.getChannelData(1)]})},this.configure=function(t){for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n])},this.record=function(t=null,n=""){g=!0,h=t,p=n},this.stop=function(){g=!1,c=null,f=0,d=0,l=null,i=null,s=null,u=!1},this.clear=function(){wcvaMicButtonInCtx=null,p=null,w.postMessage({command:"wcvaClear"})},this.getBuffers=function(t){m=t||o.callback,w.postMessage({command:"wcvaGetBuffers"})},this.exportWAV=function(t,n){if(m=t||o.callback,n=n||o.type||"audio/wav",!m)throw new Error("Callback not set");w.postMessage({command:"wcvaExportWAV",type:n})},this.exportMonoWAV=function(t,n){if(m=t||o.callback,n=n||o.type||"audio/wav",!m)throw new Error("Callback not set");w.postMessage({command:"wcvaExportMonoWAV",type:n})},this.convertBlobToBase64=function(t){return new Promise(function(n,e){if(!(void 0!==t&&t&&t instanceof Blob))return void e(null);let o=new FileReader;o.readAsDataURL(t),o.onload=function(){let t=o.result;void 0!==t&&t&&-1!==t.indexOf(",")?n(t.split(",")[1]):e(null)},o.onerror=function(t){o.abort()},o.onabort=function(){e(null)}})},w.onmessage=function(t){var n=t.data;m(n)},r.connect(this.node),this.node.connect(this.context.destination)}}(window);
var wcvaSampleRate,wcvaRecLength=0,wcvaRecBuffersL=[],wcvaRecBuffersR=[];function wcvaInit(e){wcvaSampleRate=e.sampleRate}function wcvaRecord(e){wcvaRecBuffersL.push(e[0]),wcvaRecBuffersR.push(e[1]),wcvaRecLength+=e[0].length}function wcvaExportWAV(e){let t=wcvaEncodeWAV(wcvaInterleave(wcvaMergeBuffers(wcvaRecBuffersL,wcvaRecLength),wcvaMergeBuffers(wcvaRecBuffersR,wcvaRecLength))),a=new Blob([t],{type:e});this.postMessage(a)}function wcvaExportMonoWAV(e){let t=wcvaEncodeWAV(wcvaMergeBuffers(wcvaRecBuffersL,wcvaRecLength),!0),a=new Blob([t],{type:e});this.postMessage(a)}function wcvaGetBuffers(){let e=[];e.push(wcvaMergeBuffers(wcvaRecBuffersL,wcvaRecLength)),e.push(wcvaMergeBuffers(wcvaRecBuffersR,wcvaRecLength)),this.postMessage(e)}function wcvaClear(){wcvaRecLength=0,wcvaRecBuffersL=[],wcvaRecBuffersR=[]}function wcvaMergeBuffers(e,t){let a=new Float32Array(t),c=0,n=e.length;for(var r=0;r<n;r++)a.set(e[r],c),c+=e[r].length;return a}function wcvaInterleave(e,t){for(var a=e.length+t.length,c=new Float32Array(a),n=0,r=0;n<a;)c[n++]=e[r],c[n++]=t[r],r++;return c}function wcvaFloatTo16BitPCM(e,t,a){let c=a.length;for(let n=0;n<c;n++,t+=2){let c=Math.max(-1,Math.min(1,a[n]));e.setInt16(t,c<0?32768*c:32767*c,!0)}}function wcvaWriteString(e,t,a){let c=a.length;for(var n=0;n<c;n++)e.setUint8(t+n,a.charCodeAt(n))}function wcvaEncodeWAV(e,t){let a=new ArrayBuffer(44+2*e.length),c=new DataView(a);return wcvaWriteString(c,0,"RIFF"),c.setUint32(4,32+2*e.length,!0),wcvaWriteString(c,8,"WAVE"),wcvaWriteString(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,t?1:2,!0),c.setUint32(24,wcvaSampleRate,!0),c.setUint32(28,4*wcvaSampleRate,!0),c.setUint16(32,4,!0),c.setUint16(34,16,!0),wcvaWriteString(c,36,"data"),c.setUint32(40,2*e.length,!0),wcvaFloatTo16BitPCM(c,44,e),c}this.onmessage=function(e){switch(e.data.command){case"wcvaInit":wcvaInit(e.data.config);break;case"wcvaRecord":wcvaRecord(e.data.buffer);break;case"wcvaExportWAV":wcvaExportWAV(e.data.type);break;case"wcvaExportMonoWAV":wcvaExportMonoWAV(e.data.type);break;case"wcvaGetBuffers":wcvaGetBuffers();break;case"wcvaClear":wcvaClear()}};
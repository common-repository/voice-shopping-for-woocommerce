window.addEventListener("load",function(){let e=localStorage.getItem("wcvaPendingPlaybackPath");null!=e&&(localStorage.setItem("wcvaPendingPlaybackPath",""),void 0!==e&&e&&(wcvaIntentResponsePlayer.configure(e),wcvaIntentResponsePlayer.play()));let t=localStorage.getItem("wcvaCtx");null!=t&&(wcvaMyContext=JSON.parse(t),localStorage.setItem("wcvaCtx","{}"));let n=localStorage.getItem("wcvaStat");null!=n&&(wcvaMyStatus=JSON.parse(n),localStorage.setItem("wcvaStat","{}"))}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var wcvaRespTimeOut=!1,wcvaErrcnt=0,wcvaMyStatus={},wcvaMyContext={},wcvaWin1=-1,wcvaWin2=-1,wcvaIsTalking=!1,wcvaIsGtmPresent=!1;let wcvaGtagConfigCount=0,wcvaGaConfiguredForGtag=!1,wcvaGoogleAnalyticsTrackingId=void 0!==wcva.wcvaGaTrackingId?wcva.wcvaGaTrackingId:null;if(void 0!==wcva.wcvaGaTrack&&"yes"==wcva.wcvaGaTrack)try{if("function"!=typeof ga||wcvaGoogleAnalyticsTrackingId||ga(function(){wcvaGoogleAnalyticsTrackingId=ga.getAll()[0].get("trackingId")}),void 0!==window.dataLayer){let e=window.dataLayer.length;for(let t=0;t<e;t++){let n=window.dataLayer[t];if(void 0!==n.event&&"gtm.js"===n.event){wcvaIsGtmPresent=!0;break}if("object"==typeof n)Object.values(n).forEach(function(e,t){"config"===e&&(wcvaGtagConfigCount+=1),void 0!==e.indexOf&&-1!==e.indexOf("UA-")&&(wcvaGaConfiguredForGtag=!0)})}}}catch(o){console.log("WCVA Google Analytics support detection error: "+o.message),wcvaGtagConfigCount=0,wcvaGaConfiguredForGtag=!1,wcvaGoogleAnalyticsTrackingId=null}var wcvaBotResponseTimeoutDuration=null;wcvaBotResponseTimeoutDuration=(wcvaBotResponseTimeoutDuration=(wcvaBotResponseTimeoutDuration=void 0!==wcva.wcvaBotResponseTimeout&&null!==wcva.wcvaBotResponseTimeout?isNaN(wcvaBotResponseTimeoutDuration=parseInt(wcva.wcvaBotResponseTimeout))?5:wcvaBotResponseTimeoutDuration:5)<5?5:wcvaBotResponseTimeoutDuration)>10?10:wcvaBotResponseTimeoutDuration,wcvaBotResponseTimeoutDuration*=1e3;var wcvaIntentResponsePlayer={htmlAudioElement:document.createElement("AUDIO"),lastFilePath:null,antiMuteButtonPlaybacks:[wcvaSilenceSoundPath],isAntiMutePlayback:!1,configure:function(e=null,t=null){try{let n=void 0!==e&&e?e:null;n?(this.htmlAudioElement.src=wcvaPathUrl+n,this.htmlAudioElement.preload="auto",this.lastFilePath=n,-1!==this.antiMuteButtonPlaybacks.indexOf(n)?this.isAntiMutePlayback=!0:this.isAntiMutePlayback=!1):(this.htmlAudioElement.src="",this.isAntiMutePlayback=!1),this.htmlAudioElement.onplay=(function(){wcvaIsTalking=!0,wcvaWidgetToggleButton.classList.add("responding"),wcvaWidgetChatHeader.classList.add("responding"),window.wcvaBotTimeoutIdentifier=setTimeout(()=>{wcvaWidgetToggleButton.classList.remove("responding"),wcvaWidgetChatHeader.classList.remove("responding")},wcvaBotResponseTimeoutDuration)}).bind(this),this.htmlAudioElement.onended=(function(){wcvaIsTalking=!1,this.htmlAudioElement.src="",this.muteButton("hide"),this.isAntiMutePlayback=!1,n&&"function"==typeof t&&(t(),t=null)}).bind(this),this.htmlAudioElement.onerror=(function(){wcvaIsTalking=!1,this.muteButton("hide"),this.isAntiMutePlayback=!1}).bind(this),this.htmlAudioElement.onplaying=(function(){wcvaIsTalking=!0,this.muteButton("show")}).bind(this)}catch(o){this.clear(),this.isAntiMutePlayback=!1}},play:function(){try{this.htmlAudioElement&&this.htmlAudioElement.src&&this.htmlAudioElement.play().catch(function(e){console.log("WCVA Exception: Failed to play audio.")})}catch(e){this.clear()}},stop:function(){try{this.clear()}catch(e){this.clear()}},clear:function(){try{if(this.htmlAudioElement){let e=isNaN(this.htmlAudioElement.duration)?0:this.htmlAudioElement.duration;this.htmlAudioElement.currentTime=e}this.lastFilePath=null}catch(t){this.lastFilePath=null,this.isAntiMutePlayback=!1}this.muteButton("hide")},muteButton:function(e){try{if(this.isAntiMutePlayback||void 0===wcvaResponseControllerEl||!wcvaResponseControllerEl||void 0===e)return!1;"show"==e?wcvaResponseControllerEl.classList.remove("wcva-hide-element"):(wcvaResponseControllerEl.classList.add("wcva-hide-element"),this.isPlaying()&&this.stop())}catch(t){}},isPlaying:function(){let e=isNaN(this.htmlAudioElement.currentTime)?0:this.htmlAudioElement.currentTime,t=isNaN(this.htmlAudioElement.duration)?0:this.htmlAudioElement.duration;return e<t}};let wcvaResponseControllers=document.querySelectorAll("span.wcva-response-controller");if(void 0!==wcvaResponseControllers&&null!=wcvaResponseControllers&&wcvaResponseControllers.length>0){let i=wcvaResponseControllers.length;for(let a=0;a<i;a++)wcvaResponseControllers[a].remove()}var wcvaResponseControllerEl=document.createElement("span"),wcvaResponseControllerPositionClass="wcva-response-controller-middle-right",wcvaMicPos=wcva.wcvaSelectedMicPosition?wcva.wcvaSelectedMicPosition.toLowerCase():"middle right";switch(wcvaMicPos){case"middle left":wcvaResponseControllerPositionClass="wcva-response-controller-middle-left";break;case"top right":wcvaResponseControllerPositionClass="wcva-response-controller-top-right";break;case"top left":wcvaResponseControllerPositionClass="wcva-response-controller-top-left";break;case"bottom right":wcvaResponseControllerPositionClass="wcva-response-controller-bottom-right";break;case"bottom left":wcvaResponseControllerPositionClass="wcva-response-controller-bottom-left";break;default:wcvaResponseControllerPositionClass="wcva-response-controller-middle-right"}wcvaResponseControllerEl.setAttribute("class","wcva-response-controller wcva-hide-element "+wcvaResponseControllerPositionClass);let wcvaAudioMuteIcon=document.createElement("button");wcvaAudioMuteIcon.setAttribute("type","button"),wcvaAudioMuteIcon.setAttribute("class","wcva-speaker-icon"),wcvaAudioMuteIcon.setAttribute("title","Mute Simon"),wcvaAudioMuteIcon.onclick=function(){wcvaIntentResponsePlayer.muteButton("hide")},wcvaResponseControllerEl.appendChild(wcvaAudioMuteIcon),document.body.appendChild(wcvaResponseControllerEl);let wcvaSettingsData=void 0!==wcva.wcvaConfiguredSetting?wcva.wcvaConfiguredSetting:null,wcvaHostName=void 0!==wcva.wcvaCurrentHostName?wcva.wcvaCurrentHostName:null,wcvaTypeOfDialog=void 0!==wcva.wcvaDialogType&&null!==wcva.wcvaDialogType?wcva.wcvaDialogType.trim():"generic",wcvaCustomEndpoint=void 0!==wcva.wcvaCustomEndpointUrl&&null!==wcva.wcvaCustomEndpointUrl?wcva.wcvaCustomEndpointUrl:null;null!==wcvaCustomEndpoint&&wcvaCustomEndpoint.constructor===Array&&1==wcvaCustomEndpoint.length&&(wcvaCustomEndpoint=null),wcvaTypeOfSearch=void 0!==wcva.wcvaTypeOfSearch&&null!==wcva.wcvaTypeOfSearch?wcva.wcvaTypeOfSearch:"native";let wcvaMale=!1===wcvaVoiceType.female;function wcvaGetCookie(e=null){try{if(null==e)return"";let t=e+"=",n=decodeURIComponent(document.cookie).split(";"),o=n.length;for(let i=0;i<o;i++){let a=n[i];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}}catch(s){console.log("Something went wrong while getting cookie.")}return""}function wcvaIsCustomDialogOpted(){let e=!1;try{"custom"==wcvaTypeOfDialog&&null!==wcvaCustomEndpoint&&0!=wcvaCustomEndpoint.length&&(e=!0)}catch(t){console.log("Something went wrong while checking preference of dialog type.")}return e}function wcvaCheckAndGetIntentFromSettings(e,t=null,n=null){let o=null,i={description:wcvaMessages.unableToProcess,url:"",enabled:!1};o=i;try{if(void 0!==t&&null!=t&&(i.description=t),void 0!==n&&null!=n&&0!=n.length&&(n=i.url=n.trim()),!1==wcvaIsCustomDialogOpted()&&void 0!==e&&0!=e.length&&null!=wcvaSettingsData&&e in wcvaSettingsData){let a=wcvaSettingsData[e],s="response"in a?a.response:null,l="url"in a?a.url:"";void 0!==s&&null!=s&&0!=s.length&&(i.description=s),void 0!==l&&null!=l&&0!=l.length&&(i.url=l.trim());let r=!1;if("enabled"in a){let c=a.enabled;r=null!=c,r=!0===r&&"enabled"==c.trim()}i.enabled=r}!0==wcvaIsCustomDialogOpted()&&(i.enabled=!0)}catch(u){i=o,console.log("Something went wrong while checking settings:"+u.message)}return RegExp("^([a-z]+://|//)","i").test(i.url)||(0===i.url.indexOf("www.")?i.url="http://"+i.url:(i.url="/"==i.url.charAt(0)?i.url:"/"+i.url,i.url=wcvaGetCurrentHostURL()+i.url)),i.description=i.description.trim(),i}function wcvaStt(e,t,n){if(!1==t){let o=wcvaAlternativeResponse.randomLib;!1==wcvaRespTimeOut&&(wcvaIntentResponsePlayer.configure(o[Math.floor(10*Math.random())]),wcvaIntentResponsePlayer.play(),wcvaRespTimeOut=!0,setTimeout(function(){wcvaRespTimeOut=!1},6e3))}let i=wcvaWebSocketUrl.url+wcvaWebSocketUrl.tokenQs+wcvaServiceKeys.iSTT+wcvaWebSocketUrl.otherQs,a=new WebSocket(i);a.onopen=function(t){var n;n=t,a.send(JSON.stringify({action:"start","content-type":"audio/wav",interim_results:!1,max_alternatives:3,smart_formatting:!0})),a.send(e),a.send(JSON.stringify({action:"stop"})),wcvaLogServiceCall()},a.onclose=function(e){},a.onmessage=function(e){(function e(t){let o=JSON.parse(t.data);if(void 0!=o.results){let i="",s=!1;for(let l in o.results)!0==o.results[l].final&&(i+=o.results[l].alternatives[0].transcript,s=!0);wcvaErrcnt=0,(!0==s||0==o.results.length)&&("function"==typeof n&&n(i),a.close())}})(e)},a.onerror=function(t){var o;o=t,wcvaErrcnt++,a.close(),void 0!==wcva.wcvaXApiKey&&null!==wcva.wcvaXApiKey&&wcvaErrcnt<2&&wcvaRefreshVoiceServicesKeys().then(function(t){wcvaServiceKeys.iSTT=t,wcvaStt(e,!0,n)}).catch(function(e){alert(e)})}}function wcvaLogWithGoogleAnalytics(e,t){try{if(void 0===wcva.wcvaGaTrack||null==wcva.wcvaGaTrack)return;if("yes"==wcva.wcvaGaTrack){let n=!1,o="Voice Shopping For WooCommerce - Conversation Log",i="[ USER QUERY:- "+e+" ] [ SIMON RESPONSE:- "+t+" ]";if(wcvaIsGtmPresent&&(window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"VoiceShoppingForWooCommerce-QueryResponse",wcvaQueryResponse:i}),n=!0),!(wcvaGoogleAnalyticsTrackingId&&-1!==wcvaGoogleAnalyticsTrackingId.indexOf("UA-")))throw"Unable to send WCVA conversation log to Google Analytics due to unavaibility of the Google Analytics tracking Id.";if(!n&&"function"==typeof gtag&&wcvaGtagConfigCount>0&&!0===wcvaGaConfiguredForGtag){let a={event_category:o};if(wcvaGtagConfigCount>1){if(wcvaGoogleAnalyticsTrackingId)a.send_to=wcvaGoogleAnalyticsTrackingId;else throw'Multiple "gtag" configurations detected but Google Analytics tracking id is missing.'}gtag("event",i,a),n=!0}if(n||"function"!=typeof ga||(ga("send","event",o,i),n=!0),!n)throw"Supported Google Analytics library not available."}}catch(s){let l="string"==typeof s?s:s.message;console.log("WCVA Google Analytics Log Process Error: "+l)}}function wcvaSendDialog(e,t,n=null){if(!(void 0!==wcva.wcvaXApiKey&&null!==wcva.wcvaXApiKey)||!(void 0!==e&&null!=e&&""!=e.trim()))return;let o=window.location.href;console.log("Will send the URL: "+o+" to SimonAI as base URL"),wcvaMyStatus.cUrl=o;let i={msg:e,context:wcvaMyContext,status:wcvaMyStatus};function a(t){try{if(null!==n){let o=null;o=localStorage.getItem("wcvaChatHistory"),null!=o&&(n.chatConvoEl.innerHTML=""),n.userMsgEl.innerHTML=e,n.simonMsgEl.innerHTML=t,n.userMsgElWrapper.appendChild(n.userMsgEl),n.chatConvoEl.appendChild(n.userMsgElWrapper),n.chatConvoEl.appendChild(n.simonMsgEl),null==o?localStorage.setItem("wcvaChatHistory",n.chatConvoEl.innerHTML):(o=o+" "+n.chatConvoEl.innerHTML,localStorage.setItem("wcvaChatHistory",o),n.chatConvoEl.innerHTML=o),void 0!==n.chatConvoEl.scrollTop&&void 0!==n.chatConvoEl.scrollHeight&&(n.chatConvoEl.scrollTop=n.chatConvoEl.scrollHeight),n.expandCollapseHandle()}}catch(i){}}let s=JSON.stringify(i,null,!0),l=new XMLHttpRequest;new Date().getTime();let r={userQuery:"",simonResponse:""};l.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var n=JSON.parse(this.responseText);if(!(void 0!==n&&n)){t(wcvaAlternativeResponse.unableToProcess);return}n.description="undefined"!=n.description?n.description:"",n.url="undefined"!=n.url?n.url:"",wcvaLogWithGoogleAnalytics(e,n.description),n.status,wcvaMyStatus=n.status,n.context,wcvaMyContext=n.context;let o=void 0!==wcvaMyStatus.intent?wcvaMyStatus.intent:"",i=void 0!==wcvaMyStatus.prodStr?wcvaMyStatus.prodStr:null,s=void 0!==wcvaMyStatus.prodCategoryStr?wcvaMyStatus.prodCategoryStr:null;if("productSearch"==o||"productCategory"==o||"AddToCart"==o||"ProductGroups"==o)try{let l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText);if(e=e.data,void 0!=e.code){console.log(e.error);return}"ProductGroups"==o&&void 0!=wcvaSettingsData[o]?!1==wcvaSettingsData[o].enabled?(n.description=e.voice_response,n.url=e.redirect_url,wcvaSettingsData[o]={enabled:"enabled",response:n.description,intent_name:"intent",intent_audio_response:{path:e.path,voice:e.voice},delete_audio_response:"0",option_name:"wcva_product_search",url:n.url}):(""==wcvaSettingsData[o].response&&(n.description=e.voice_response,wcvaSettingsData[o].response=e.voice_response),""==wcvaSettingsData[o].url&&(n.url=e.redirect_url,wcvaSettingsData[o].url=e.redirect_url)):(n.description=e.voice_response,n.url=e.redirect_url,wcvaSettingsData[o]={enabled:"enabled",response:n.description,intent_name:"intent",intent_audio_response:{path:e.path,voice:e.voice},delete_audio_response:"0",option_name:"wcva_product_search",url:n.url})}},l.open("POST",wcvaAjaxObjForFuzzySearch.ajax_url,!1),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send("action=wcva_fuzzy_search&_ajax_nonce="+wcvaAjaxObjForFuzzySearch.nonce+"&intent_of_user="+o+"&prodStr="+i+"&prodCategoryStr="+s+"&address_bar_url="+document.location.href)}catch(c){console.log("We had an error. Error:"+c.message);return}let u=wcvaCheckAndGetIntentFromSettings(o,n.description,n.url.toLowerCase());if(n.description=u.description,n.url=u.url,!1==u.enabled){t(wcvaAlternativeResponse.disabledIntentResponse,null,!0);let d=wcvaMessages.traditionalSearch;a(d),r.userQuery=e,r.simonResponse=d,localStorage.setItem("wcvaWidgetConversation",JSON.stringify(r,null,!0));return}if(n.description){let v=wcvaAlternativeResponse.defaultDesc;if(wcvaIsCustomDialogOpted()){let p=wcvaGetExistingCustomDialogResponse(wcvaVoiceAndLanguage,n.description);p?(v=void 0!==p.path&&p.path?p.path:wcvaAlternativeResponse.defaultDesc,C()):wcvaCustomDialogTtsOnTheFly(n.description).then(function(e){e&&(v=void 0!==e.path&&e.path?e.path:wcvaAlternativeResponse.defaultDesc),C()}).catch(function(e){console.log("WCVA Error: Something went wrong while TTS process for custom dialog."),C()})}else{let g=wcvaGetGenericDialog(wcvaVoiceAndLanguage,o),w=g.dialog,h=g.generateAudio;if(w&&!0===h){let f="option_name"in w&&w.option_name?w.option_name:null,m="response"in w&&w.response?w.response:null;m&&f&&wcvaGenericDialogTtsOnTheFly(m,f).then(function(e){v=void 0!==e&&void 0!==e.path?e.path:wcvaAlternativeResponse.defaultDesc,C()}).catch(function(e){console.log("WCVA Error: Something went wrong while TTS process for generic dialog."),C()})}else{let $=w&&void 0!==w.intent_audio_response?w.intent_audio_response:{},y="path"in $&&$.path?$.path:null;y&&(v=y),C()}}function C(){if(a(n.description),r.userQuery=e,r.simonResponse=n.description,localStorage.setItem("wcvaWidgetConversation",JSON.stringify(r,null,!0)),wcvaClientInfo.ios||wcvaClientInfo.android&&wcvaClientInfo.firefox||wcvaClientInfo.safari&&!wcvaClientInfo.chrome&&!wcvaClientInfo.firefox&&!wcvaClientInfo.edge||wcvaClientInfo.windows&&wcvaClientInfo.firefox)t(v,function(){void 0==n.url||""==n.url||wcvaUrlPointsToCurrentPage(n.url)?localStorage.removeItem("wcvaWidgetConversation"):location.assign(n.url)});else if(void 0!=n.url&&""!=n.url){let o=wcvaUrlIsPartOfCurrentDomain(n.url.toLowerCase());if(null==o){t(v),localStorage.removeItem("wcvaWidgetConversation"),alert(wcvaMessages.pageUnavailable);return}if(!1==o){try{-1!=wcvaWin1&&wcvaWin1.close()}catch(i){console.log("We had an error. Error "+i.message)}wcvaWin1=window.open(n.url,n.url),t(v),localStorage.removeItem("wcvaWidgetConversation")}else n.description,!function e(n){var o=null;let i=n,a=i.indexOf("#"),s=!1;if(a>-1&&(wcvaUrlPointsToCurrentPage(i=i.substring(0,a))?console.log("We need to navigate within the same page"):s=!0),-1==n.indexOf("#")||!0==s){if(!0===wcvaIsTalking){var o=setTimeout(function(){e(n),clearInterval(o)},500);return}wcvaMyStatus.intent="",wcvaMyStatus.prodStr=null,wcvaMyStatus.prodCategoryStr=null,localStorage.setItem("wcvaPendingPlaybackPath",v),localStorage.setItem("wcvaCtx",JSON.stringify(wcvaMyContext,null,!0)),localStorage.setItem("wcvaStat",JSON.stringify(wcvaMyStatus,null,!0)),void 0!==o&&null!=o&&clearInterval(o)}else t(v),localStorage.removeItem("wcvaWidgetConversation");location.assign(n)}(n.url.trim())}else t(v),localStorage.removeItem("wcvaWidgetConversation");if(void 0!=n.url2&&""!=n.url2){try{-1!=wcvaWin2&&wcvaWin2.close()}catch(s){console.log("We had an error. Error "+s.message)}wcvaWin2=window.open(n.url2,n.url2),localStorage.removeItem("wcvaWidgetConversation")}}}}else 4==this.readyState&&200!=this.status&&wcvaLogWithGoogleAnalytics(e,wcvaMessages.callFailed)};try{var c=wcva.wcvaSendDialogApiUrl;wcvaIsCustomDialogOpted()&&(c=wcvaCustomEndpoint),l.open("POST",c,!0),l.setRequestHeader("Accept","application/json"),l.setRequestHeader("Content-type","application/json"),l.setRequestHeader("Access-Control-Allow-Origin","*"),l.setRequestHeader("x-api-key",wcva.wcvaXApiKey),l.send(s)}catch(u){console.log("We had an error. Error:"+u.message),localStorage.removeItem("wcvaWidgetConversation");return}}function wcvaGetCurrentHostURL(){var e=null;try{if(!(void 0!==window.location&&void 0!==window.location.hostname&&void 0!==window.location.protocol))return wcvaGetHostName();var t=window.location.protocol,n=window.location.hostname;e=t+"//"+n}catch(o){e=wcvaGetHostName(),console.log("Something went wrong while discovering current domain.")}return e}function wcvaGetHostName(){return wcvaHostName}function wcvaUrlIsPartOfCurrentDomain(e){let t=!1;try{if(null==e)return null;let n="";0===e.indexOf("http://")?n="http://":0===e.indexOf("https://")&&(n="https://");let o=0==n.length?0:n.length,i=e.substring(o),a=i.indexOf("/"),s=i;-1!=a&&(s=i.substring(0,a)),s=n+s,0===s.indexOf(wcvaGetCurrentHostURL())&&(t=!0)}catch(l){t=null,console.log("Something went wrong while checking URL.")}return t}function wcvaUrlPointsToCurrentPage(e=null){var t=!1;try{if(!(null!=e))return!0;var n=window.location.href;e=e.trim();var o=n[n.length-1];o="/"==o?o:null,0!=e.length&&e.indexOf("/")==e.length-1&&void 0!==o&&"/"!=o&&(n+="/"),n==e&&(t=!0)}catch(i){t=!0,console.log("Something went wrong while getting current full URL.")}return t}function wcvaLogServiceCall(e=0){try{let t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText);wcvaServiceLogs.updatedAt=e.updatedAt||wcvaServiceLogs.updatedAt,wcvaServiceLogs.currentValue=e.currentValue||wcvaServiceLogs.currentValue,wcvaServiceLogs.lastValue=e.lastValue||wcvaServiceLogs.lastValue}},t.open("POST",wcvaAjaxObj.ajax_url,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send("action=wcva_log_service_call&_ajax_nonce="+wcvaAjaxObj.nonce+"&updateLastValue="+e)}catch(n){}}function wcvaRefreshVoiceServicesKeys(){return new Promise(function(e,t){let n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState){if(200===this.status){let n=JSON.parse(this.response),o=void 0!==n.token?n.token:null;if(o)e(o);else{if(wcvaSttLanguageContext.gcp.stt&&"gStt"in n&&n.gStt){e(n.gStt);return}t(wcvaErrorLibrary.outOfService)}}else t(wcvaErrorLibrary.outOfService)}};let o="?action=wcva_refresh_access_keys&_ajax_nonce="+wcvaAjaxObj.keys_nonce;n.open("GET",wcvaAjaxObj.ajax_url+o,!0),n.onerror=function(e){t(wcvaErrorLibrary.outOfService)},n.send(null)})}function wcvaGcpStt(e){return new Promise(function(t,n){if(!(wcvaSttLanguageContext.gcp.endPoint&&wcvaSttLanguageContext.gcp.key&&wcvaSttLanguageContext.gcp.langCode&&void 0!==e&&e)){n(null);return}if(0==wcvaErrcnt){let o=wcvaAlternativeResponse.randomLib;wcvaIntentResponsePlayer.configure(o[Math.floor(10*Math.random())]),wcvaIntentResponsePlayer.play()}let i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState)try{let e=JSON.parse(this.response);if(200===this.status){wcvaErrcnt=0;let o=void 0!==e&&e instanceof Object&&"results"in e?e.results:[],i=o&&o.length>0&&o[0]instanceof Object?o[0]:{},a="alternatives"in i&&i.alternatives?i.alternatives:[],s=a.length>0&&a[0]instanceof Object?a[0]:{},l="transcript"in s&&s.transcript?s.transcript:null;void 0!==l&&l?t(l):n(null)}else{let r="error"in e?e.error:{},c="message"in r&&r.message?r.message.toLowerCase():"";wcvaErrcnt<1&&c&&-1!==c.indexOf("api key")?(wcvaErrcnt++,wcvaRefreshVoiceServicesKeys().then(function(e){wcvaSttLanguageContext.gcp.key=e,wcvaGcpStt().then(function(e){e?t(e):(wcvaErrcnt=0,n(null))}).catch(function(e){wcvaErrcnt=0,n(null)})}).catch(function(e){alert(e),wcvaErrcnt=0,n(null)})):(wcvaErrcnt=0,n(null))}}catch(u){n(null)}},i.onerror=function(e){n(null)},i.open("POST",wcvaSttLanguageContext.gcp.endPoint+wcvaSttLanguageContext.gcp.qs.key+wcvaSttLanguageContext.gcp.key,!0),i.setRequestHeader("Content-Type","application/json;charset=UTF-8");let a={config:{encoding:"ENCODING_UNSPECIFIED",languageCode:wcvaSttLanguageContext.gcp.langCode,enableWordTimeOffsets:!1},audio:{content:e}};i.send(JSON.stringify(a,null,!0))})}function wcvaFormatEmail(e=null){let t=e;try{if(e&&null!==e){let n=e.toLowerCase();t=n=n.replace(/dot/gi,".").replace(/at/gi,"@").replace(/underscore/gi,"_").replace(/dotcom/gi,".com").replace(/dotorg/gi,".org").replace(/dotnet/gi,".net").replace(/dotint/gi,".int").replace(/dotedu/gi,".edu").replace(/ /g,"")}}catch(o){t=e}return t}function wcvaGetExistingCustomDialogResponse(e,t){let n=null;try{if(void 0!==wcva.wcvaCustomResponses&&wcva.wcvaCustomResponses&&void 0!==e&&e){let o=wcva.wcvaCustomResponses.length;e=e.trim(),t=t.trim();for(let i=0;i<o;i++){let a=wcva.wcvaCustomResponses[i],s=void 0!==a.response&&a.response?a.response.trim():null,l=void 0!==a.voice&&a.voice?a.voice.trim():null;if(s&&l&&s===t&&e===l){n=JSON.parse(JSON.stringify(a));break}}}}catch(r){n=null}return n}function wcvaGetGenericDialog(e,t){this.existingDialog={dialog:{},generateAudio:!1};try{if(!(void 0!==wcvaSettingsData&&wcvaSettingsData&&void 0!==e&&e&&void 0!==t&&t))throw"WCVA Error: Settings data or parameters are missing while checking generic dialog existence.";if(this.selectedVoice=e.trim(),this.intentName=t.trim(),this.dialog=this.intentName in wcvaSettingsData?wcvaSettingsData[this.intentName]:{},!(this.dialog&&Object.keys(this.dialog).length>0))throw"WCVA Error: Dialog is missing while checking generic dialog existence.";this.existingDialog.dialog=JSON.parse(JSON.stringify(this.dialog));let n="response"in this.dialog&&this.dialog.response?this.dialog.response.trim():null,o="enabled"in this.dialog&&this.dialog.enabled?this.dialog.enabled.trim():null,i="intent_audio_response"in this.dialog&&this.dialog.intent_audio_response?this.dialog.intent_audio_response:{},a="voice"in i&&i.voice?i.voice.trim():null,s="path"in i&&i.path?i.path.trim():null;void 0!==n&&n&&void 0!==o&&o&&"enabled"===o&&(!(void 0!==s&&s)||!(void 0!==a&&a&&a===this.selectedVoice))&&(this.existingDialog.generateAudio=!0)}catch(l){this.existingDialog={dialog:{},generateAudio:!1}}return this.existingDialog}function wcvaCustomDialogTtsOnTheFly(e){return new Promise(function(t,n){if(!(void 0!==e&&e)){n(null);return}let o=new FormData;o.append("response_text",e),o.append("action","wcva_custom_dialog_text_to_speech"),o.append("_ajax_nonce",wcvaAjaxObj.custom_dialog_nonce);let i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState){if(200===this.status){let e=JSON.parse(this.response),o=void 0!==e.success&&!0===e.success,i=void 0!==e.data?e.data:null;if(i&&o){let a=void 0!==i.updated_collection?i.updated_collection:null,s=void 0!==i.custom_response?i.custom_response:null;a&&s?(wcva.wcvaCustomResponses=a,t(s)):n(null)}else n(null)}else n(null)}},i.onerror=function(e){n(wcvaErrorLibrary.outOfService)},wcvaAjaxObj.custom_dialog_nonce,i.open("POST",wcvaAjaxObj.ajax_url,!0),i.send(o)})}function wcvaGenericDialogTtsOnTheFly(e,t){return new Promise(function(n,o){if(!(void 0!==e&&e&&void 0!==t&&t)){o(null);return}let i=new FormData;i.append("dialog_text",e),i.append("dialog_op_name",t),i.append("user","tts"),i.append("action","wcva_generic_dialog_tts_on_the_fly"),i.append("_ajax_nonce",wcvaAjaxObj.generic_dialog_nonce);let a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState){if(200===this.status){let e=JSON.parse(this.response),t=void 0!==e.success&&!0===e.success,i=void 0!==e.data?e.data:null;if(i&&t){if(void 0!==i.path&&i.path){let a=void 0!==i.updated_generic_dialogs?i.updated_generic_dialogs:null;a&&Object.keys(a).length>0&&(wcvaSettingsData=a),n(i)}else o(null)}else o(null)}else o(null)}},a.onerror=function(e){o(wcvaErrorLibrary.outOfService)},a.open("POST",wcvaAjaxObj.ajax_url,!0),a.send(i)})}
var wcvaSynthErrorCount=0;function toggleWcvaDialogType(e="generic"){try{let t="wcv-assistant-hide",n=document.querySelector("div[data-wcva-notice]");"generic"==e?(document.getElementById("wcvAssistantDialogConfigFormSection").classList.remove(t),document.getElementById("wcvAssistantCustomEndpointRow").classList.add(t),n&&null!==n&&n.classList.remove(t)):(document.getElementById("wcvAssistantDialogConfigFormSection").classList.add(t),document.getElementById("wcvAssistantCustomEndpointRow").classList.remove(t),n&&null!==n&&n.classList.add(t))}catch(e){}}function toggleIntentAccessiblity(e){try{if(e&&null!==e){let t=["data-response-name","data-url-name","data-save-button-name"],n=!(!e.checked||!0!==e.checked),i=t.length;for(let a=0;a<i;a++){let i=t[a],o=e.getAttribute(i);if(!o||null===o)continue;let l=document.querySelector(o);l&&null!==l&&(l.type&&"submit"===l.type?!0===n&&l.removeAttribute("disabled"):!0===n?l.removeAttribute("readonly"):l.setAttribute("readonly",n))}}}catch(e){}}function wcvaToggleGaTrackingIdField(e=null){try{if(void 0===e||!e)return!1;let t=document.querySelector("div[id=wcvaGaTrackingIdWrapper]");if(t){t.classList.toggle("wcva-hide-element")}}catch(e){}}function wcvaResetTimeoutDefaultValue(e,t){void 0!==e&&(0==e.value.length?e.value="8":parseInt(e.value)>20?e.value="20":parseInt(e.value)<8&&(e.value="8"))}function wcvaValidateTimeoutValue(e,t){void 0!==e&&2==e.value.length&&parseInt(e.value)>20&&t.preventDefault()}function wcvaVoiceChange(e){let t=e.value,n=e.getAttribute("data-old-value"),i=e.getAttribute("data-do-synthesize");t&&n&&n!==t?e.setAttribute("data-do-synthesize",!0):i&&"true"===i&&e.setAttribute("data-do-synthesize",!1)}function wcvaGaIdChange(e){if(e){let n=e.value,i=e.getAttribute("data-error");function t(t=null){if(!t||"show"!=t&&"hide"!=t)return!1;let n=document.getElementById("wcvaGaIdError"),i=document.getElementById("wcvAssistantBasicConfigSettingsSave"),a="",o="",l="",r="";"show"==t?(a="2px solid #FF0000",o="#FF0000",l="1",r="block",i&&i.setAttribute("disabled","disabled")):(a="",o="#000000",l="0",r="none",i&&i.removeAttribute("disabled")),e.style.outline=a,e.style.color=o,e.setAttribute("data-error",l),n&&(n.style.display=r)}if(n){let e=n.toLowerCase();(1==e.length&&"u"==e||2==e.length&&"ua"==e||e.length>2&&"ua-"==e.substring(0,3))&&"1"==i&&t("hide"),(1==e.length&&"u"!=e||2==e.length&&"ua"!=e||e.length>2&&"ua-"!=e.substring(0,3))&&"0"==i&&t("show")}else"1"==i&&t("hide")}}function wcvaGetSynthesizableIntents(e){let t=e?"data-intents-with-audios":"data-intents-for-audio-regeneration",n=document.getElementById("wcvAssistantDialogConfigFormSection"),i=n?n.getAttribute(t):null;return i?JSON.parse(i):null}function wcvaSynthesizeRecursively(e,t,n,i){let a=void 0!==e&&e?e:null,o=void 0!==t&&t?t:null,l=void 0!==n&&n?n:null;if(!(a&&a.length>0)||wcvaSynthErrorCount>0){let e=wcvaSynthErrorCount;return wcvaSynthErrorCount=0,wcvaSynthesizeProcPopup("hide",!0),void("function"==typeof i?i(e>0):0==e&&window.location.reload())}let r=a.shift(),s=document.querySelector("form[data-intent-option-key="+r+"]"),u=s?s.elements:null;if(!u)return;let c=u[r+"[response]"],d=c?c.getAttribute("data-old-value"):null;d&&(wcvaUpdateSynthCounter(l,parseInt(l)-parseInt(a.length)),wcvaSynthesize(d,r,null,o).then(function(){wcvaSynthesizeRecursively(a,o,l,i)}).catch(function(e){let t=void 0!==e&&e?e:{},n=("code"in t&&t.code,"error"in t?t.error:null);n&&alert(n),wcvaSynthErrorCount+=1,wcvaSynthesizeRecursively(a,o,l,i)}))}function wcvaSynthesize(e,t,n,i){"undefined"==typeof isLanguageChange||!isLanguageChange||isLanguageChange;let a=void 0!==e&&e?e:null,o=void 0!==t&&t?t:null,l="Unable to synthesize the dialog. ";return new Promise(function(e,t){let r=new FormData;if(!a||!o)return void t({code:"WCVA_ERROR_5",error:l+"Required parameters are missing."});r.append("dialog_text",a),r.append("dialog_op_name",o),void 0!==i&&i&&r.append("voice_for_synth",i),r.append("action","wcva_synthesize"),r.append("_ajax_nonce",wcvaAjaxObj.synthesize_nonce);let s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==this.readyState)if(200===this.status){let i=JSON.parse(this.response),a=void 0!==i&&"success"in i?i.success:null,r=void 0!==i&&"data"in i?i.data:null;if(a){if(r&&void 0!==n&&n){let e="voice"in r?r.voice:null,t="path"in r?r.path:null,i=n.elements;if(e&&t&&void 0!==i&&i){let n=i[o+"[intent_audio_response][voice]"],a=i[o+"[intent_audio_response][path]"];n.value=e,a.value=t}}e()}else{"code"in r&&r.code;let e="error"in r?r.error:null;t({code:"WCVA_ERROR_6",error:e?l+e:l})}}else t({code:"WCVA_ERROR_7",error:l+"Technically improper request to the server."})},s.open("POST",wcvaAjaxObj.ajax_url,!0),s.send(r)})}function wcvaBasicFormSubmitHandler(e,t){if(void 0!==e&&e){let n=!1,i=e.querySelector("select[data-synth-decider=voice]"),a=i?i.getAttribute("data-do-synthesize"):null;if(n=!(!a||"true"!==a)){t.preventDefault();let n=i.value.trim(),a=(i.getAttribute("data-old-value"),wcvaGetSynthesizableIntents(!0));a&&a.length>0?(wcvaSynthesizeProcPopup("show",!0),wcvaSynthesizeRecursively(a,n,a.length,function(t){e.submit()})):e.submit()}}}function wcvaDialogFormSubmitHandler(e,t){if(e){let n=!1,i=e.elements,a=e.getAttribute("data-intent-option-key"),o=i[a+"[response]"],l=o?o.getAttribute("data-old-value").trim():null,r=o?o.value.trim():null,s=i[a+"[enabled]"],u=(s&&s.getAttribute("data-old-value").trim(),s?s.value.trim():null);r&&l!==r&&(n=!0);let c=i[a+"[intent_audio_response][voice]"],d=c?c.value:null,v=e.getAttribute("data-current-voice");!1===n&&u&&"enabled"==u&&d&&v&&d!==v&&(n=!0),n&&r&&(t.preventDefault(),wcvaSynthesizeProcPopup("show",!1),wcvaSynthesize(r,a,e,null).then(function(t){wcvaSynthesizeProcPopup("hide",!1),e.submit()}).catch(function(t){let n=void 0!==t&&t?t:{},i=("code"in n&&n.code,"error"in n?n.error:null);wcvaSynthesizeProcPopup("hide",!1),i&&alert(i),e.submit()}))}}function wcvaSynthesizeProcPopup(e,t){if(void 0!==e&&"show"!=e&&"hide"!=e)return;let n=document.getElementById("wcvaLoaderModal");try{if(!n)return;let i="none",a="auto";if("show"==e){i="block",a="none";let e=document.getElementById("wcvaTotalSynthResponseSection");if(e){let n=void 0!==t&&!0===t;e.style.display=n?"block":"none"}}n.style.display=i,document.body.style.pointerEvents=a}catch(e){n&&(n.style.display="none"),document.body.style.pointerEvents="auto"}}function wcvaUpdateSynthCounter(e,t){let n=document.getElementById("wcvaTotalSynthResponseSection");try{if(n&&"block"==n.style.display){let i=n.querySelector("span[id=wcvaCurrentDialog]"),a=n.querySelector("span[id=wcvaTotalSynthesizableDialogs]");i&&a&&(a.innerText=e,i.innerText=t)}}catch(e){n&&(n.style.display="none")}}window.addEventListener("load",function(){let e=wcvaGetSynthesizableIntents(!1);e&&e.length>0&&(wcvaSynthesizeProcPopup("show",!0),wcvaSynthesizeRecursively(e,null,e.length,null))}),document.body.addEventListener("load",function(){document.body.style.pointerEvents="auto"});